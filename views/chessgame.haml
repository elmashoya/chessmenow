%table(id="chessboard" cellpadding=0 cellspacing=0)
  - for i in session[:color] == 'b' ? 1..8 : (1..8).to_a.reverse
    %tr
      - for j in ('a'..'h')
        %td(width="45px" height="45px" id="#{j+i.to_s}" class="#{(i+j.ord) % 2 == 1 ? 'white-tile' : 'black-tile'}")
          %div
%h2#turn
#table_info
  Pick a color:
  %input(type="submit" value="white" id="pick_white")
  %input(type="submit" value="black" id="pick_black")
%div= session

:javascript
  var chess = new Chess();
  var game_id = "#{params[:game_id]}";
  var your_color = "#{session[:color]}";
  var fen = "#{fen}";
  var selected;

  $(document).ready(function() {
    $("td").click(function() {
      var position = $(this).attr('id');
      if (selected && chess.move(selected, position)) {
        movePiece(selected, position);
        displayTurn();
      }
      else if (isYourPiece(position)) {
        if (!$(this).hasClass('selected')) {
          $(this).addClass('selected');
          selected = position;
        } else {
          $(this).removeClass('selected');
          selected = null;
        }
      }
      $("td").not(this).removeClass("selected");
    });
    initializeBoard(fen);

    $("#pick_white").click(function() {
      $.post("/" + game_id + "/color", {color: 'w'}, function(data) {
        alert('you chose white!')
      });
      return false;
    });
    $("#pick_black").click(function() {
      $.post("/" + game_id + "/color", {color: 'b'}, function(data) {
        alert('you chose black!')
      });
      return false;
    });

    var poll = function() {
      $.get("/" + game_id + "/wait", function(data) {
        if (data !== chess.fen()) {
          alert('position changed!')
        }
      });
    }
  });
